<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-loading-bar.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Time will tell">
<meta property="og:type" content="website">
<meta property="og:title" content="Michael-Jay">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Michael-Jay">
<meta property="og:description" content="Time will tell">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="吴华杰">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Michael-Jay</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
   <script type="text/javascript" src="/js/clicklove.js"></script>
  

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Michael-Jay</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-study">

    <a href="/study/" rel="section"><i class="fas fa-marker fa-fw"></i>文章分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/jay.jpg">
      <meta itemprop="name" content="吴华杰">
      <meta itemprop="description" content="Time will tell">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael-Jay">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/" class="post-title-link" itemprop="url">永福</a>
        </h2>

        <div class="post-meta">
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-08-07 16:09:34" itemprop="dateCreated datePublished" datetime="2024-08-07T16:09:34+08:00">2024-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-08 09:00:46" itemprop="dateModified" datetime="2024-08-08T09:00:46+08:00">2024-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%9E%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">实习</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%9E%E4%B9%A0/%E6%B0%B8%E7%A6%8F/" itemprop="url" rel="index"><span itemprop="name">永福</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="海纳特电项目"><a href="#海纳特电项目" class="headerlink" title="海纳特电项目"></a>海纳特电项目</h1><p>这个项目是一个老项目，我主要负责新增或者维护一些功能接口。</p>
<h2 id="工商业光伏项目模块"><a href="#工商业光伏项目模块" class="headerlink" title="工商业光伏项目模块"></a>工商业光伏项目模块</h2><h3 id="下载模板"><a href="#下载模板" class="headerlink" title="下载模板"></a>下载模板</h3><p>提供一个下载 excel 模板的接口，如图：<img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/1.png" alt="image.png"><br>代码逻辑比较简单，在对应的 <strong>controller</strong> 中加一个方法即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;下载模板&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/download/template&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">downloadTemplate</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    response.setContentType(<span class="string">&quot;application/vnd.ms-excel&quot;</span>);</span><br><span class="line">    response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename*=utf-8&#x27;&#x27;工商业光伏项目模板.xlsx&quot;</span>);</span><br><span class="line">    IOUtils.copyLarge(templateResource.getInputStream(), response.getOutputStream());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>方法参数：</strong><ul>
<li>接收一个 response 参数，用于向客户端发送 HTTP 响应。</li>
</ul>
<p>	</p>
</li>
<li><strong>方法体：</strong><ul>
<li>设置相应的 contentType，表示下载的文件为 excel 文件。</li>
<li>设置了Content-Disposition响应头部，指示客户端以附件形式下载文件。</li>
<li>最后，通过IOUtils工具类将模板文件的输入流写入到HTTP响应的输出流中，从而实现文件下载。</li>
</ul>
</li>
</ul>
<h3 id="导入-excel-文件"><a href="#导入-excel-文件" class="headerlink" title="导入 excel 文件"></a>导入 excel 文件</h3><p>提供一个导入 excel 文件的接口，如下图：<br><img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/2.png" alt="image.png"><br>直接看核心方法代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">importExcel</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">    List&lt;PhotovoltaicEarlyStageExcelReq&gt; list;</span><br><span class="line">    List&lt;PhotovoltaicEarlyStage&gt; addData = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;Project&gt; addData2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        list = ExcelUtils.readExcel(file.getInputStream(), PhotovoltaicEarlyStageExcelReq.class);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JafException</span>(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 进行校验和入库对象的转换</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">        <span class="type">PhotovoltaicEarlyStageExcelReq</span> <span class="variable">photovoltaicEarlyStageExcelReq</span> <span class="operator">=</span> list.get(i);</span><br><span class="line">        <span class="type">PhotovoltaicEarlyStage</span> <span class="variable">photovoltaicEarlyStage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PhotovoltaicEarlyStage</span>();</span><br><span class="line">        <span class="type">Project</span> <span class="variable">project</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Project</span>();</span><br><span class="line">        BeanUtil.copyProperties(photovoltaicEarlyStageExcelReq,photovoltaicEarlyStage);</span><br><span class="line">        <span class="comment">//赋值，除了“项目性质”字段</span></span><br><span class="line">        String[] ignoreProperties = &#123;<span class="string">&quot;nature&quot;</span>&#125;;</span><br><span class="line">        BeanUtil.copyProperties(photovoltaicEarlyStageExcelReq,project,ignoreProperties);</span><br><span class="line">        <span class="comment">//单独给“项目性质”字段赋值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">nature</span> <span class="operator">=</span> photovoltaicEarlyStageExcelReq.getNature();</span><br><span class="line">        project.setNature(ProjectNatureEnum.getCodeByDesc(nature));</span><br><span class="line">        <span class="comment">//单独给“项目类型”字段赋值</span></span><br><span class="line">        project.setType(ProjectTypeEnum.GFXM.getCode());</span><br><span class="line">        <span class="comment">//检验项目名称是否为空</span></span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isBlank(photovoltaicEarlyStageExcelReq.getName()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JafException</span>(String.format(RMsg.IMPORT_EXCEL_CHECK_DATA_ERROR, (i + <span class="number">1</span>), <span class="string">&quot;项目名称&quot;</span>, <span class="string">&quot;不能为空！&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//根据项目名称获取电站信息,并校验电站信息是否存在</span></span><br><span class="line">        <span class="type">StationManage</span> <span class="variable">stationManage</span> <span class="operator">=</span> stationManageService.getDetailByProjectName(photovoltaicEarlyStageExcelReq.getName());</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(stationManage)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">JafException</span>(String.format(RMsg.IMPORT_EXCEL_CHECK_DATA_ERROR, (i + <span class="number">1</span>), <span class="string">&quot;项目对应的电站信息&quot;</span>, <span class="string">&quot;不存在！&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        addData2.add(project);</span><br><span class="line">        addData.add(photovoltaicEarlyStage);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isNotEmpty(addData)) &#123;</span><br><span class="line">        <span class="built_in">this</span>.saveBatch(addData);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(CollectionUtils.isNotEmpty(addData2))&#123;</span><br><span class="line">        projectService.saveBatch(addData2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>方法参数：</strong><ul>
<li>file 参数用于接受用户提供的 excel 文件。</li>
</ul>
</li>
<li><strong>方法体：</strong><ol>
<li>首先创建一个 dto 实体类PhotovoltaicEarlyStageExcelReq，其字段和 excel 中的列名相对应。</li>
<li>由于这个 excel 的字段涉及到两张表，即<strong>PhotovoltaicEarlyStage</strong> 和<strong>Project</strong> 实体类，因此分别创建对应的两个 list 集合，用于存最后需要保存到数据库的数据。</li>
<li>使用ExcelUtils 的方法，将传进来的 excel 转成对应的 list 集合。</li>
<li>遍历 list 集合，使用 BeanUtil 的 copyProperties 方法将 dto 中的数据转存至开头说的那两个实体类中，<strong>但是有些数据需要手动赋值，因为有些字段需要利用枚举将 code 转换成 name</strong>。将赋值完的实体加入对应的 list 集合中，即 b 操作对应的两个 list 集合。</li>
<li>利用 saveBatch 方法将两个 list 集合保存至数据库中。</li>
</ol>
</li>
</ul>
<h3 id="导出-excel-文件"><a href="#导出-excel-文件" class="headerlink" title="导出 excel 文件"></a>导出 excel 文件</h3><p>提供一个导出 excel 文件的接口，该接口将页面的所有数据导出至 excel 文件中，需要导出的数据稍微有点复杂，如下图：<img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/3.png" alt="image.png"><br>这些数据包括三大块五张表：基础信息、往来单位、项目计划。基础信息包括三个表：PhotovoltaicEarlyStage、Project、User 表。往来单位包括一张表：OtherUnit。项目计划包括一张表：PhotovoltaicEarlyPlan。<br>这里导出时要注意：<strong>每一个项目计划都对应着 excel 的一条记录，也就是说有 16 个项目计划，就要有 16 条 excel 记录，这些记录的基础信息、往来单位字段都是一样的</strong>。<br><strong>因此导出数据的时候，每一个工商业光伏项目对应 m 个项目计划，有 n 个工商业光伏项目记录的话，一共就需要导出 n*m 条 excel 记录，所以代码逻辑是需要两层 for 循环的。</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(PhotovoltaicEarlyStagePageReq requestBody, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    List&lt;PhotovoltaicEarlyStage&gt; list = list(<span class="built_in">this</span>.getQueryWrapper(requestBody));</span><br><span class="line">    List&lt;PhotovoltaicEarlyStage&gt; finalList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (PhotovoltaicEarlyStage photovoltaicEarlyStage : list)&#123;</span><br><span class="line">        <span class="type">Project</span> <span class="variable">project</span> <span class="operator">=</span> projectService.getById(photovoltaicEarlyStage.getProjectId());</span><br><span class="line">        <span class="comment">//填充基础信息字段</span></span><br><span class="line">        photovoltaicEarlyStage.setProjectName(project.getName());</span><br><span class="line">        photovoltaicEarlyStage.setProjectCode(project.getCode());</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">nature</span> <span class="operator">=</span> project.getNature();</span><br><span class="line">        photovoltaicEarlyStage.setProjectNatureName(ProjectNatureEnum.getDescByCode(nature));</span><br><span class="line">        userService.fillUserNameByList(list,PhotovoltaicEarlyStage::getProjectManagerUid,PhotovoltaicEarlyStage::setProjectManagerName);</span><br><span class="line">        userService.fillUserNameByList(list,PhotovoltaicEarlyStage::getAreaManagerUid,PhotovoltaicEarlyStage::setAreaManagerName);</span><br><span class="line">        <span class="comment">//填充往来单位字段</span></span><br><span class="line">        <span class="type">OtherUnit</span> <span class="variable">otherUnit</span> <span class="operator">=</span> otherUnitService.getById(photovoltaicEarlyStage.getStructuralSurveyUnitId());</span><br><span class="line">        <span class="keyword">if</span>(otherUnit!=<span class="literal">null</span>) photovoltaicEarlyStage.setStructuralSurveyUnitName(otherUnit.getName());</span><br><span class="line">        <span class="type">OtherUnit</span> <span class="variable">otherUnit1</span> <span class="operator">=</span> otherUnitService.getById(photovoltaicEarlyStage.getStructuralReviewUnitId());</span><br><span class="line">        <span class="keyword">if</span>(otherUnit1!=<span class="literal">null</span>) photovoltaicEarlyStage.setStructuralReviewUnitName(otherUnit1.getName());</span><br><span class="line">        <span class="type">OtherUnit</span> <span class="variable">otherUnit2</span> <span class="operator">=</span> otherUnitService.getById(photovoltaicEarlyStage.getDesignUnitId());</span><br><span class="line">        <span class="keyword">if</span>(otherUnit2!=<span class="literal">null</span>) photovoltaicEarlyStage.setDesignUnitName(otherUnit2.getName());</span><br><span class="line">        <span class="type">OtherUnit</span> <span class="variable">otherUnit3</span> <span class="operator">=</span> otherUnitService.getById(photovoltaicEarlyStage.getControlUnitId());</span><br><span class="line">        <span class="keyword">if</span>(otherUnit3!=<span class="literal">null</span>) photovoltaicEarlyStage.setControlUnitName(otherUnit3.getName());</span><br><span class="line">        <span class="type">OtherUnit</span> <span class="variable">otherUnit4</span> <span class="operator">=</span> otherUnitService.getById(photovoltaicEarlyStage.getConstructionUnitId());</span><br><span class="line">        <span class="keyword">if</span>(otherUnit4!=<span class="literal">null</span>) photovoltaicEarlyStage.setConstructionUnitName(otherUnit4.getName());</span><br><span class="line">        <span class="comment">//填充项目计划字段</span></span><br><span class="line">        List&lt;PhotovoltaicEarlyPlan&gt; list1 = photovoltaicEarlyPlanService.list(Wrappers.lambdaQuery(PhotovoltaicEarlyPlan.class).eq(PhotovoltaicEarlyPlan::getStageId, photovoltaicEarlyStage.getId()));</span><br><span class="line">        <span class="keyword">for</span> (PhotovoltaicEarlyPlan photovoltaicEarlyPlan : list1)&#123;</span><br><span class="line">            <span class="comment">//PhotovoltaicEarlyStage副本,防止原始PhotovoltaicEarlyStage被污染</span></span><br><span class="line">            <span class="type">PhotovoltaicEarlyStage</span> <span class="variable">photovoltaicEarlyStage1</span> <span class="operator">=</span> mapperFacade.map(photovoltaicEarlyStage,PhotovoltaicEarlyStage.class);</span><br><span class="line">            <span class="comment">//photovoltaicEarlyPlan对象部分字段 填充 到PhotovoltaicEarlyStage中</span></span><br><span class="line">            <span class="type">PhotovoltaicEarlyPlanTemplate</span> <span class="variable">photovoltaicEarlyPlanTemplate</span> <span class="operator">=</span> photovoltaicEarlyPlanTemplateService.getOne(Wrappers.lambdaQuery(PhotovoltaicEarlyPlanTemplate.class)</span><br><span class="line">                    .eq(PhotovoltaicEarlyPlanTemplate::getNodeCode, photovoltaicEarlyPlan.getNodeCode()));</span><br><span class="line">            photovoltaicEarlyStage1.setProjectNode(photovoltaicEarlyPlanTemplate.getProjectNode());</span><br><span class="line">            photovoltaicEarlyStage1.setPlanStartTime(photovoltaicEarlyPlan.getPlanStartTime());</span><br><span class="line">            photovoltaicEarlyStage1.setPlanEndTime(photovoltaicEarlyPlan.getPlanEndTime());</span><br><span class="line">            photovoltaicEarlyStage1.setActualStartTime(photovoltaicEarlyPlan.getActualStartTime());</span><br><span class="line">            photovoltaicEarlyStage1.setActualEndTime(photovoltaicEarlyPlan.getActualEndTime());</span><br><span class="line">            userService.fillUserNameByList(list1,PhotovoltaicEarlyPlan::getManagerUid,PhotovoltaicEarlyPlan::setManagerName);</span><br><span class="line">            photovoltaicEarlyStage1.setManager(photovoltaicEarlyPlan.getManagerName());</span><br><span class="line">            <span class="comment">//PhotovoltaicEarlyStage1对象加入finalList中</span></span><br><span class="line">            finalList.add(photovoltaicEarlyStage1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;PhotovoltaicEarlyStageExportExcelReq&gt; photovoltaicEarlyStageExportExcelReqs = mapperFacade.mapAsList(finalList, PhotovoltaicEarlyStageExportExcelReq.class);</span><br><span class="line">    ExcelUtils.exportExcelByClass(response,<span class="string">&quot;光伏项目&quot;</span>,photovoltaicEarlyStageExportExcelReqs, PhotovoltaicEarlyStageExportExcelReq.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>主要逻辑就是将需要导出的记录数据封装到一个 PhotovoltaicEarlyStage 实体类组成的 finalList 集合中，再调用mapperFacade 中的 mapAsList 方法将字段 copy 到一个由 dto 组成的集合中，这个 dto 是专门为了导出 excel 建立的 dto 实体类。最后再调用ExcelUtils 的exportExcelByClass 方法将集合中的数据导出到 excel 文件中。<br><strong>也可以使用 BeanUtil 的 copyPropertity 方法代替 mapperFacade ，其区别是：</strong><br><strong>copyPropertity 默认是浅拷贝，mapperFacade 默认是深拷贝。</strong><br><strong>几个犯错的地方：</strong></p>
<ul>
<li><p><strong>深拷贝浅拷贝问题：</strong>同一条光伏项目数据对应多条项目计划条目，这些条目的基础信息、往来单位字段都是一样的，但是项目计划的字段不一样，因此在第一层 for 循环后，需要将之前保存了基础信息等字段的实体类存一个副本，这里存副本的时候，我是用的直接赋值的方式，这种方式属于<strong>浅拷贝</strong>，<strong>拷贝的只是对象的内存地址，相当于栈中的两个引用指向了堆中的同一个对象</strong>，后面修改的时候就会对原始副本对象造成污染。后续我采用<strong>深拷贝</strong>的方式：mapperFacade.map 拷贝了原始副本，<strong>深拷贝的两个引用对应的就是堆中的两个不同的对象了，只是数据一样而已。</strong></p>
</li>
<li><p>在mapperFacade.mapAsList 的转换中出现的问题：</p>
<ul>
<li>出现原始 dto 的属性值没有移植到目标 dto 对象，原因是目标 dto 的类中没有加入@DATA注解。 因为mapAsList 底层也需要通过 set 方式进行数据移植的。</li>
<li><strong>LocalDateTime 日期格式转换错误问题：</strong> 在调用 mapperFacade.mapAsList 将集合映射到另一个 dto 集合时，出现了日期格式转换错误问题，解决方法是：自定义一个转换器类，需要实现阿里巴巴的Converter<LocalDateTime>接口，然后在注解@ExcelProperty 中添加此转换器即可。</LocalDateTime></li>
</ul>
</li>
<li><p><strong>空指针异常问题</strong>：经常出现一些字段报空指针异常错误，需要有判空操作。</p>
</li>
</ul>
<h2 id="运维管理模块"><a href="#运维管理模块" class="headerlink" title="运维管理模块"></a>运维管理模块</h2><h3 id="巡检计划和巡检记录——增删改查操作"><a href="#巡检计划和巡检记录——增删改查操作" class="headerlink" title="巡检计划和巡检记录——增删改查操作"></a>巡检计划和巡检记录——增删改查操作</h3><p><strong>巡检指对设备（即电站）进行定期检查和维护的活动，以确保其正常运行和安全性。巡检记录是关联于巡检计划的，因此删除计划之前需要先判断有无对应的记录，有的话则无法删除（踩坑点）。</strong><br><img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/4.png" alt="image.png"><br>包括巡检计划和巡检记录两个表，<strong>巡检记录</strong>中又内嵌一个<strong>巡检结果表</strong>，如下图：<br><img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/5.png" alt="image.png"><br>因此在巡检记录实体类中添加一个非数据库字段：<strong>由巡检结果实体组成的 list 集合</strong>。同时巡检结果实体中需要有一个字段关联该巡检记录 id。<br>常规的增删改查就不多说了，说几个做的过程中需要注意的点：</p>
<ul>
<li><strong>关联问题</strong>：巡检记录是关联于巡检计划的，因此在删除巡检计划的时候，需要判断对应的巡检记录有没有删除，如果没有删除是不允许删除巡检计划的。</li>
<li><strong>日期类字段问题</strong>：由于前端传过来的日期是字符串格式，后端是日期格式，两者不兼容，因此后端与前端交互的实体类中的日期字段需要添加<strong>日期转换格式</strong>的注解：	<ul>
<li>日期类： @DateTimeFormat(pattern &#x3D; CommonConstants.DOMAIN_DATE_PATTERN)  </li>
<li>日期+时间类： @JsonFormat(pattern &#x3D; CommonConstants.DOMAIN_TIME_PATTERN, timezone &#x3D; CommonConstants.DOMAIN_TIME_ZONE)</li>
</ul>
</li>
<li>在巡检计划表中，电站名和负责人都是以 id 的形式存储的，因此<strong>在对应的实体类中需要添加两个非数据库字段，对应电站的名称和负责人的名称</strong>。电站的名称需要关联另外一张表查询，负责人名称需要调用用户中心的接口查询。</li>
<li>类似于巡检状态这种下拉框的字段一般存于一个字典表 dim 中，表中用 int 类型存储，实体类中设置一个非数据库字段：巡检状态名称。 然后通过 dimservice 提供的接口将 int 转换成对应的名称。</li>
<li>删除接口中，由于是批量删除，所以前端传过来的应该是一个 id 字符串组成的 list 集合，需要用 <strong>@RequestBody @ApiParam(value &#x3D; “ids”,required &#x3D; true) String[] ids</strong> 接收。</li>
</ul>
<h3 id="1-2-2-故障记录和故障维修记录——增删改查操作"><a href="#1-2-2-故障记录和故障维修记录——增删改查操作" class="headerlink" title="1.2.2 故障记录和故障维修记录——增删改查操作"></a>1.2.2 故障记录和故障维修记录——增删改查操作</h3><p><strong>这两个模块主要是记录了之前巡检发电站检查出来的故障，以及对应的故障维修记录。这里要注意的是：一条故障记录可能对应多条故障维修记录。</strong><br>常规的增删改查操作，就不详细记录了。</p>
<h3 id="运维后发电对比"><a href="#运维后发电对比" class="headerlink" title="运维后发电对比"></a>运维后发电对比</h3><p><img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/6.png" alt="image.png"></p>
<h3 id="运维结算"><a href="#运维结算" class="headerlink" title="运维结算"></a>运维结算</h3><p><img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/7.png" alt="image.png"><br><strong>在“查看详情” 功能接口中，涉及到一个分页查询</strong>，如下图：<br><img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/8.png" alt="image.png"><br>一开始没看到是一个分页查询，就直接给前端返回了一个运维记录列表 result，后面发现需要返回一个分页类型 Page 类，于是我<strong>采用 stream 流将 result 集合转化成Page 类需要的集合，以进行分页操作</strong>，具体如下面这条代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;OperationRecordRes&gt; resultList = result.stream()</span><br><span class="line">.skip((pageReq.getCurrent() - <span class="number">1</span>) * pageReq.getSize())</span><br><span class="line">.limit(pageReq.getSize())</span><br><span class="line">.collect(Collectors.toList());</span><br></pre></td></tr></table></figure>

<ul>
<li>**skip((pageReq.getCurrent() - 1) * pageReq.getSize())**：这部分代码调用了 <strong>skip()</strong> 方法，它的作用是跳过指定数量的元素。在这里，我们要跳过的元素数量是 <strong>(当前页数 - 1) * 每页大小</strong>。这样就实现了将流中的元素移动到当前页的起始位置。</li>
<li>限制从流中获取的元素数量，确保不超过每页的大小。</li>
<li>使用 <strong>collect()</strong> 方法，将处理后的元素收集到一个新的列表中，并返回该列表作为结果。</li>
</ul>
<p><strong>${}和#{}的使用区别：</strong></p>
<p>一般来说为了保证 sql 注入安全，通常占位符会使用#{}。<br><strong>在 xml 文件中写 sql 语句的时候，使用 order by #{}，无法按照预期的顺序，后换成${}即可。</strong>网上查询原因得知：**#{}会将传入的数据都当成一个字符串，会对自动传入的数据加一个双引号**，而 order by 后的字段不能加双引号，否则会失效。 </p>
<h2 id="项目复盘及收获（⭐）"><a href="#项目复盘及收获（⭐）" class="headerlink" title="项目复盘及收获（⭐）"></a>项目复盘及收获（⭐）</h2><p><strong>项目介绍：</strong></p>
<p>本项目是一个b端项目，主要是为用户提供一套关于<strong>光伏项目的解决方案</strong>，后端主要是用 Java 实现的一个<strong>新能源信息化管理系统</strong>，主要管理的就是这些光伏项目。<br>解释一下<strong>光伏</strong>：<br>光伏项目分为两种：<strong>户用光伏</strong>和<strong>工商业光伏</strong>，</p>
<blockquote>
<ul>
<li><strong>户用光伏</strong> ：所谓户用光伏就是安装在居民房子上的光伏，将光伏板安装在老百姓的屋顶上（以农村居民屋顶为主），安装完成之后，电站可以并入国家电网，发的电一部分优先供给家里用，用不完的可以出售给国家电网。</li>
<li><strong>工商业光伏</strong>： 工商业光伏更多的是将光伏板放在工商业厂房、仓库上面。工商业分布式光伏主要是利用工商企业屋顶，采用多样化的分布式光伏方案，将太阳能转为电能，从而实现电量的自发自用。</li>
</ul>
</blockquote>
<p>整个管理系统大致分为三个大模块：<strong>项目管理、数据展示、系统配置</strong>。<br><strong>① 项目管理模块是该项目的主要模块，主要是跟光伏项目相关的一些功能接口，比如：</strong></p>
<p>两种光伏项目分别对应<strong>前期阶段</strong>和<strong>建设期阶段</strong>，一个项目只能对应一个阶段，并且只能从前期阶段转为建设期阶段，不能反向转换。</p>
<blockquote>
<ul>
<li><strong>光伏前期阶段：</strong> 表中包括：<strong>项目名称</strong>、<strong>项目编号</strong>、<strong>项目经理</strong>、<strong>所在区域</strong>、<strong>预计投资额</strong> 、<strong>项目计划</strong>（嵌套了一张表,包含项目的各个节点，以及计划开始时间、计划结束时间、实际开始时间、实际结束时间……）等字段。</li>
<li><strong>光伏建设期阶段：</strong> 表中包括：开工日期、竣工日期、建设进度（包括好几个进度字段，前端是下拉框的形式，因此这些字段是由一个字典表维护的）等字段。</li>
</ul>
</blockquote>
<p>除了俩个阶段之外还有很多其他的功能，比如<strong>故障管理</strong>和<strong>维修管理</strong>等功能，比如<strong>维修管理</strong>又包括<strong>维修计划</strong>和<strong>维修记录</strong>，应该是先有计划，再有记录，添加记录时需要关联计划，并且一条计划是对应多条记录的，这些都是业务上需要理解的。当时这里就由于业务理解不深刻犯了些错误（扯“删除计划时需要判断有无相关联的记录”的事情）。</p>
<p><strong>② 数据展示模块主要是将数据信息以可视化的形式展示出来，比如电站的发电量数据、售电数据等。</strong><br><strong>③ 系统配置就是一些边角料的一些功能，比如角色管理、用户管理、用户权限管理啊等等…</strong></p>
<p><strong>我主要负责项目管理这个模块，给项目添加一些新功能、新接口，并维护一些老功能</strong>。功能主要包括：<strong>常规的增删改查、导入导出数据文件excel 、导入模板的下载  等等…</strong></p>
<p><strong>开发过程中遇到的一些典型错误：</strong></p>
<ul>
<li><p><strong>深浅拷贝问题：</strong></p>
<ul>
<li>导出 excel 数据的时候，每一个工商业光伏项目对应 m 个项目计划，有 n 个工商业光伏项目记录的话，一共就需要导出 n<em>m 条 excel 记录，所以代码逻辑是需要两层 for 循环的。<strong>最终我需要的是一个 list 集合，里边是一连串的 excelDto 实体类型的对象</strong>，<strong>这个 dto 的字段就是需要导出的数据字段，最后将 list 集合导出即可。</strong>在第一层 for 循环结尾需要将当前的工商业光伏项目拷贝一份，保存副本，防止后面被污染，这里存副本的时候，我是用的直接赋值的方式，这种方式属于<strong>浅拷贝</strong>，<strong>拷贝的只是对象的内存地址，相当于栈中的两个引用指向了堆中的同一个对象</strong>，后面修改的时候就会对原始副本对象造成污染。后续我采用<strong>深拷贝</strong>的方式：mapperFacade.map 拷贝了原始副本，*<em>深拷贝的两个引用对应的就是堆中的两个不同的对象了，只是数据一样而已。</em></em></li>
</ul>
</li>
<li><p><strong>#{} 和 ${} 的区别：</strong></p>
<ul>
<li>**一般来说为了保证 sql 注入安全，通常占位符会使用#{}。在 xml 文件中写 sql 语句的时候，使用 order by #{}，无法按照预期的顺序排列，后换成${}即可。网上查询原因得知：#{}会将传入的数据都当成一个字符串，会对自动传入的数据加一个双引号，而 order by 后的字段不能加双引号，否则会失效。 **</li>
</ul>
</li>
<li><p><strong>使用 mybatisplus 的 getOne 查询报错问题：</strong></p>
<ul>
<li>使用 getOne 查询数据的时候，如果符合条件的数据有多条，就会报 Expected one result (or null) to be returned by selectOne(), but found: 2 的错误。</li>
<li>出现这个错误的原因主要是：一般情况下项目和发电站是<strong>一对一</strong>的，但是由于某些原因数据库中出现了<strong>一对多</strong>的情况，此时你使用 getOne 来查询就会出现多条数据。 <strong>解决办法：在 getOne 语句最后加一条“.last(limit 1)”，这样就只会取出最新的那条数据了。</strong></li>
</ul>
</li>
<li><p><strong>空指针问题：</strong></p>
<ul>
<li><strong>注意判空。 事前需要基于对业务的理解，这样才知道哪些字段可能为空，哪些字段不可能为空；事后利用 dubug 调试，哪些字段出现了空指针的问题。</strong></li>
</ul>
</li>
</ul>
<p><strong>将可以复用的代码封装起来：</strong><br><strong>通过用户输入的地址信息转换成对应的邮政编码，如中国-福建省-泉州市-晋江市转换为 350582。</strong></p>
<h1 id="户用光伏智能设计项目"><a href="#户用光伏智能设计项目" class="headerlink" title="户用光伏智能设计项目"></a>户用光伏智能设计项目</h1><p>这个项目是公司刚接的新项目，我相当于是从头跟着做的。</p>
<h2 id="基础库建设模块"><a href="#基础库建设模块" class="headerlink" title="基础库建设模块"></a>基础库建设模块</h2><p>“基础库建设”模块较为特殊，该模块其实就是一张表，这张表包含 4 个一级目录，7 个二级目录，这些目录分别对应一个子表，这些子表的结构都不太一样，如图：</p>
<p><img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/9.png" alt="image.png"></p>
<p>整个大表可以看做是一颗树，因此我建立了一个总表<strong>basic_classification</strong>来维护所有子目录以及它们之间的层级关系，如图：</p>
<p><img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/10.png" alt="image.png"></p>
<p><strong>跟前端沟通之后，需要提前将所有子表的中文字段返回给前端，以供他进行展示</strong>。这是因为这整张大表是只对应一个接口的，而这些小表是没有对应的接口的，相当于一个异步展示的过程，所以在访问大表之后，就需要提前将所有需要展示的中文字段返回给前端。 这里我在总表中添加了一个非数据库字段：List<ChineseDim> chineseDim,该字段是一个ChineseDim 泛型的集合，每一个ChineseDim 对象都对应一个子表的字段信息，ChineseDim 对象的字段包括：<br><img src="/2024/08/07/%E6%B0%B8%E7%A6%8F%E5%AE%9E%E4%B9%A0/11.png" alt="image.png"></ChineseDim></p>
<ul>
<li><strong>关键字段：</strong><ul>
<li><strong>classification_id：</strong> 对应该子表的 id。</li>
<li><strong>name：</strong> 该表的中文字段名。</li>
<li><strong>type：</strong> 该字段的类型。（前端需要根据它判断需要输入数据的类型）</li>
<li><strong>sort：</strong> 排序字段，根据这个决定页面展示各个中文字段的顺序。</li>
</ul>
</li>
</ul>
<p>当用户访问”基础库建设”模块时，后端会查询总表，返回一个 list 集合，该集合记录了所有子目录的信息，也包括这些目录的中文字段信息。（即刚刚添加的非数据库字段），接着会调用本地的 getTree 方法将集合转换成树结构，供前端显示。</p>
<p>剩下的子表开发就比较简单了，每个子表建立相对应的数据库表，使用 mybatis-plus 提供的代码生成器生成对应的 controller、service、mapper 以及对应的实体类 Entity，再编写相应的 crud 代码即可。</p>

      
    </div>

    
    
    
	
	 
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
	
	<!-- require APlayer -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
    <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
    <!-- require MetingJS-->
    <script src="https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script> 
    <!--qq音乐-->   
    <meting-js
		auto="https://c6.y.qq.com/base/fcgi-bin/u?__=nYC8LhwMbhVJ">
	</meting-js>

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="吴华杰"
      src="/images/jay.jpg">
  <p class="site-author-name" itemprop="name">吴华杰</p>
  <div class="site-description" itemprop="description">Time will tell</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:1002372564@qq.com" title="E-Mail → mailto:1002372564@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2024-07-31 @ – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">吴华杰</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">105k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">1:36</span>
</div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共60.6k字</span>
</div>



    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='255,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
